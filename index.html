<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sepay Voice Notifier</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Header -->
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 p-3 rounded-xl">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">Sepay Voice Notifier</h1>
                        <p class="text-gray-500">Th√¥ng b√°o gi·ªçng n√≥i qua tr√¨nh duy·ªát</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div id="statusIndicator" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-200">
                        <div class="w-3 h-3 rounded-full bg-gray-400"></div>
                        <span class="font-medium text-gray-700">Ch∆∞a k·∫øt n·ªëi</span>
                    </div>
                    <button id="toggleBtn" onclick="toggleConnection()" 
                            class="px-6 py-3 rounded-xl font-semibold bg-indigo-600 hover:bg-indigo-700 text-white transition-all">
                        B·∫Øt ƒë·∫ßu
                    </button>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Settings Panel -->
                <div class="bg-indigo-50 rounded-xl p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        C√†i ƒë·∫∑t
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Gi·ªçng ƒë·ªçc
                            </label>
                            <select id="voiceSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option>ƒêang t·∫£i gi·ªçng ƒë·ªçc...</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                √Çm l∆∞·ª£ng: <span id="volumeValue">100</span>%
                            </label>
                            <input type="range" id="volumeSlider" min="0" max="100" value="100" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                T·ªëc ƒë·ªô ƒë·ªçc: <span id="rateValue">1.0</span>x
                            </label>
                            <input type="range" id="rateSlider" min="0.5" max="2" step="0.1" value="1" 
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                URL Backend Server
                            </label>
                            <input type="text" id="serverUrl" value="http://localhost:3000" 
                                   placeholder="http://localhost:3000"
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <p class="text-xs text-gray-500 mt-1">ƒê·ªãa ch·ªâ server Node.js nh·∫≠n webhook</p>
                        </div>

                        <button onclick="testVoice()" 
                                class="w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors">
                            üîä Test gi·ªçng ƒë·ªçc
                        </button>
                    </div>
                </div>

                <!-- Server Info Panel -->
                <div class="bg-green-50 rounded-xl p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Th√¥ng tin k·∫øt n·ªëi</h2>
                    
                    <div class="space-y-4">
                        <div class="bg-white rounded-lg p-4 border border-green-200">
                            <p class="text-sm font-medium text-gray-700 mb-2">Webhook URL cho Sepay:</p>
                            <code id="webhookUrl" class="block text-sm text-gray-600 break-all bg-gray-50 p-3 rounded">
                                Ch∆∞a c√≥ (Kh·ªüi ƒë·ªông server tr∆∞·ªõc)
                            </code>
                        </div>

                        <div class="bg-white rounded-lg p-4 border border-green-200">
                            <p class="text-sm font-medium text-gray-700 mb-2">Tr·∫°ng th√°i WebSocket:</p>
                            <p id="wsStatus" class="text-sm text-gray-600">‚ö™ Ch∆∞a k·∫øt n·ªëi</p>
                        </div>

                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                            <p class="text-sm font-semibold text-yellow-800 mb-2">üìù H∆∞·ªõng d·∫´n:</p>
                            <ol class="text-xs text-yellow-700 space-y-1 list-decimal list-inside">
                                <li>T·∫£i file server (h∆∞·ªõng d·∫´n b√™n d∆∞·ªõi)</li>
                                <li>Ch·∫°y: <code class="bg-yellow-100 px-1">node server.js</code></li>
                                <li>Nh·∫•n n√∫t "B·∫Øt ƒë·∫ßu" ·ªü tr√™n</li>
                                <li>Copy Webhook URL v√†o Sepay</li>
                                <li>Gi·ªØ tab n√†y m·ªü ƒë·ªÉ nh·∫≠n th√¥ng b√°o</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transaction History -->
            <div class="bg-gray-50 rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        L·ªãch s·ª≠ giao d·ªãch
                    </h2>
                    <button onclick="clearHistory()" class="text-sm text-red-600 hover:text-red-700">
                        X√≥a l·ªãch s·ª≠
                    </button>
                </div>
                
                <div id="transactionList" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">Ch∆∞a c√≥ giao d·ªãch n√†o</p>
                </div>
            </div>
        </div>

        <!-- Installation Guide -->
        <div class="mt-8 bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">üì¶ H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t Server</h2>
            
            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 class="font-semibold text-gray-800 mb-3">B∆∞·ªõc 1: T·∫°o file server.js</h3>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto text-sm"><code>const express = require('express');
const cors = require('cors');
const WebSocket = require('ws');
const app = express();

app.use(cors());
app.use(express.json());

// WebSocket Server
const wss = new WebSocket.Server({ port: 8080 });

wss.on('connection', (ws) => {
    console.log('‚úì Client k·∫øt n·ªëi WebSocket');
    ws.send(JSON.stringify({ type: 'connected' }));
});

// Webhook endpoint cho Sepay
app.post('/webhook', (req, res) => {
    console.log('‚úì Nh·∫≠n webhook t·ª´ Sepay:', req.body);
    
    // G·ª≠i ƒë·∫øn t·∫•t c·∫£ clients ƒëang k·∫øt n·ªëi
    wss.clients.forEach((client) => {
        if (client.readyState === WebSocket.OPEN) {
            client.send(JSON.stringify({
                type: 'transaction',
                data: req.body
            }));
        }
    });
    
    res.json({ status: 'success' });
});

app.get('/', (req, res) => {
    res.send('Sepay Server ƒëang ch·∫°y! ‚úì');
});

app.listen(3000, () => {
    console.log('=== SEPAY SERVER ===');
    console.log('HTTP: http://localhost:3000');
    console.log('WebSocket: ws://localhost:8080');
    console.log('Webhook: http://localhost:3000/webhook');
    console.log('====================');
});</code></pre>
            </div>

            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 class="font-semibold text-gray-800 mb-3">B∆∞·ªõc 2: C√†i ƒë·∫∑t dependencies</h3>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg text-sm"><code>npm install express cors ws</code></pre>
            </div>

            <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="font-semibold text-gray-800 mb-3">B∆∞·ªõc 3: Ch·∫°y server</h3>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg text-sm"><code>node server.js</code></pre>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mt-6">
                <p class="text-sm font-semibold text-blue-800 mb-2">üí° ƒê·ªÉ nh·∫≠n webhook t·ª´ Sepay (t·ª´ internet):</p>
                <p class="text-sm text-blue-700 mb-2">C√†i ƒë·∫∑t Ngrok ƒë·ªÉ t·∫°o URL public:</p>
                <pre class="bg-white p-3 rounded text-sm"><code>ngrok http 3000</code></pre>
                <p class="text-xs text-blue-600 mt-2">Sau ƒë√≥ copy URL t·ª´ ngrok v√† th√™m /webhook ƒë·ªÉ c·∫•u h√¨nh tr√™n Sepay</p>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let isConnected = false;
        let voices = [];
        let transactions = [];

        // Load voices
        function loadVoices() {
            voices = speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '';
            
            const viVoices = voices.filter(v => v.lang.startsWith('vi'));
            const otherVoices = voices.filter(v => !v.lang.startsWith('vi'));
            
            if (viVoices.length > 0) {
                const group = document.createElement('optgroup');
                group.label = 'Ti·∫øng Vi·ªát';
                viVoices.forEach((voice, i) => {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = voice.name;
                    group.appendChild(option);
                });
                voiceSelect.appendChild(group);
            }
            
            if (otherVoices.length > 0) {
                const group = document.createElement('optgroup');
                group.label = 'Kh√°c';
                otherVoices.forEach((voice, i) => {
                    const option = document.createElement('option');
                    option.value = voices.indexOf(voice);
                    option.textContent = voice.name + ' (' + voice.lang + ')';
                    group.appendChild(option);
                });
                voiceSelect.appendChild(group);
            }
        }

        speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();

        // Volume slider
        document.getElementById('volumeSlider').addEventListener('input', (e) => {
            document.getElementById('volumeValue').textContent = e.target.value;
        });

        // Rate slider
        document.getElementById('rateSlider').addEventListener('input', (e) => {
            document.getElementById('rateValue').textContent = parseFloat(e.target.value).toFixed(1);
        });

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            const voiceIndex = document.getElementById('voiceSelect').value;
            utterance.voice = voices[voiceIndex];
            utterance.volume = document.getElementById('volumeSlider').value / 100;
            utterance.rate = parseFloat(document.getElementById('rateSlider').value);
            speechSynthesis.speak(utterance);
        }

        function testVoice() {
            speak('C√≥ giao d·ªãch m·ªõi. S·ªë ti·ªÅn 500 ngh√¨n ƒë·ªìng. T·ª´ Nguy·ªÖn VƒÉn A. N·ªôi dung: Test chuy·ªÉn kho·∫£n');
        }

        function toggleConnection() {
            if (isConnected) {
                disconnect();
            } else {
                connect();
            }
        }

        function connect() {
            const serverUrl = document.getElementById('serverUrl').value;
            const wsUrl = serverUrl.replace('http://', 'ws://').replace('https://', 'wss://').replace(':3000', ':8080');
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                isConnected = true;
                updateStatus('connected');
                document.getElementById('wsStatus').textContent = 'üü¢ ƒê√£ k·∫øt n·ªëi';
                document.getElementById('webhookUrl').textContent = serverUrl + '/webhook';
                speak('ƒê√£ k·∫øt n·ªëi th√†nh c√¥ng');
            };
            
            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                if (message.type === 'transaction') {
                    handleTransaction(message.data);
                }
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                updateStatus('error');
                document.getElementById('wsStatus').textContent = 'üî¥ L·ªói k·∫øt n·ªëi';
            };
            
            ws.onclose = () => {
                isConnected = false;
                updateStatus('disconnected');
                document.getElementById('wsStatus').textContent = '‚ö™ ƒê√£ ng·∫Øt k·∫øt n·ªëi';
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
            isConnected = false;
            updateStatus('disconnected');
        }

        function updateStatus(status) {
            const indicator = document.getElementById('statusIndicator');
            const btn = document.getElementById('toggleBtn');
            
            if (status === 'connected') {
                indicator.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="font-medium text-green-700">ƒêang ho·∫°t ƒë·ªông</span>
                `;
                indicator.className = 'flex items-center gap-2 px-4 py-2 rounded-lg bg-green-100';
                btn.textContent = 'D·ª´ng l·∫°i';
                btn.className = 'px-6 py-3 rounded-xl font-semibold bg-red-500 hover:bg-red-600 text-white transition-all';
            } else if (status === 'error') {
                indicator.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <span class="font-medium text-red-700">L·ªói k·∫øt n·ªëi</span>
                `;
                indicator.className = 'flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100';
                btn.textContent = 'Th·ª≠ l·∫°i';
                btn.className = 'px-6 py-3 rounded-xl font-semibold bg-indigo-600 hover:bg-indigo-700 text-white transition-all';
            } else {
                indicator.innerHTML = `
                    <div class="w-3 h-3 rounded-full bg-gray-400"></div>
                    <span class="font-medium text-gray-700">Ch∆∞a k·∫øt n·ªëi</span>
                `;
                indicator.className = 'flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-200';
                btn.textContent = 'B·∫Øt ƒë·∫ßu';
                btn.className = 'px-6 py-3 rounded-xl font-semibold bg-indigo-600 hover:bg-indigo-700 text-white transition-all';
            }
        }

        function handleTransaction(data) {
            const amount = data.amount || data.transferAmount || 0;
            const content = data.content || data.description || 'Kh√¥ng c√≥ n·ªôi dung';
            const sender = data.account_name || data.accountName || 'Kh√¥ng r√µ';
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                content: content,
                sender: sender,
                time: new Date().toLocaleTimeString('vi-VN')
            };
            
            transactions.unshift(transaction);
            if (transactions.length > 10) transactions.pop();
            
            renderTransactions();
            
            const message = `C√≥ giao d·ªãch m·ªõi. S·ªë ti·ªÅn ${amount.toLocaleString('vi-VN')} ƒë·ªìng. T·ª´ ${sender}. N·ªôi dung: ${content}`;
            speak(message);
        }

        function renderTransactions() {
            const list = document.getElementById('transactionList');
            if (transactions.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">Ch∆∞a c√≥ giao d·ªãch n√†o</p>';
                return;
            }
            
            list.innerHTML = transactions.map(t => `
                <div class="bg-white rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-2xl font-bold text-green-600">
                            ${t.amount.toLocaleString('vi-VN')} ‚Ç´
                        </span>
                        <span class="text-sm text-gray-500">${t.time}</span>
                    </div>
                    <p class="text-sm text-gray-700 mb-1">
                        <strong>T·ª´:</strong> ${t.sender}
                    </p>
                    <p class="text-sm text-gray-600">
                        <strong>N·ªôi dung:</strong> ${t.content}
                    </p>
                </div>
            `).join('');
        }

        function clearHistory() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªãch s·ª≠?')) {
                transactions = [];
                renderTransactions();
            }
        }
    </script>
</body>
</html>